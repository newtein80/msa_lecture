### yaml íŒŒì¼ ì •ë¦¬

#### 1. pv.yaml (PersistentVolume)

```yaml
apiVersion: v1
kind: PersistentVolume  # PVë¥¼ ì •ì˜í•˜ëŠ” Kubernetes ë¦¬ì†ŒìŠ¤
metadata:
  name: mysql-pv  # PVì˜ ì´ë¦„ (PVCì—ì„œ ë§¤ì¹­í•  ìˆ˜ë„ ìˆìŒ)
  labels:
    app: mysql  # PVCì—ì„œ íŠ¹ì • PVë¥¼ ì„ íƒí•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¼ë²¨
spec:
  capacity:
    storage: 1Gi  # PVì˜ ì „ì²´ ì €ì¥ ìš©ëŸ‰ (1GiB)
  accessModes:
    - ReadWriteOnce  # í•˜ë‚˜ì˜ ë…¸ë“œì—ì„œë§Œ ì½ê¸°/ì“°ê¸°ê°€ ê°€ëŠ¥
  persistentVolumeReclaimPolicy: Retain  # PVC ì‚­ì œ ì‹œ ë°ì´í„° ìœ ì§€ (ì¬ì‚¬ìš© ê°€ëŠ¥)
  hostPath:
    path: "/root/park/mysql"  # ì´ PVê°€ ì‹¤ì œë¡œ ë§ˆìš´íŠ¸ë  í˜¸ìŠ¤íŠ¸ì˜ ë””ë ‰í† ë¦¬ ê²½ë¡œ
```

- ì¤‘ìš”í•œ ì—°ê²° ì •ë³´:
  - `metadata.name: mysql-pv` â†’ PVCì—ì„œ ì´ PVë¥¼ ì§ì ‘ ì°¸ì¡°í•˜ì§„ ì•Šì§€ë§Œ, `spec.selector.matchLabels`ë¥¼ í†µí•´ ì„ íƒ ê°€ëŠ¥.
  - `metadata.labels.app: mysql` â†’ PVCì—ì„œ `spec.selector.matchLabels`ë¥¼ í†µí•´ ë§¤ì¹­.

#### 2. pvc.yaml (PersistentVolumeClaim)

```yaml
apiVersion: v1
kind: PersistentVolumeClaim  # PVCë¥¼ ì •ì˜í•˜ëŠ” Kubernetes ë¦¬ì†ŒìŠ¤
metadata:
  name: mysql-pvc  # PVCì˜ ì´ë¦„ (Deploymentì—ì„œ ì´ ì´ë¦„ì„ ì‚¬ìš©í•˜ì—¬ ë³¼ë¥¨ì„ ì°¸ì¡°)
  namespace: park1  # ì´ PVCê°€ ì†í•˜ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤
spec:
  accessModes:
    - ReadWriteOnce  # í•˜ë‚˜ì˜ ë…¸ë“œì—ì„œë§Œ ì½ê¸°/ì“°ê¸° ê°€ëŠ¥
  resources:
    requests:
      storage: 500Mi  # ìš”ì²­í•˜ëŠ” ì €ì¥ ìš©ëŸ‰ (500MiB)
  selector:
    matchLabels:
      app: mysql  # ì´ PVCëŠ” app=mysql ë¼ë²¨ì´ ìˆëŠ” PVë¥¼ ì„ íƒ
```

- ì¤‘ìš”í•œ ì—°ê²° ì •ë³´:
  - `metadata.name: mysql-pvc` â†’ **Deployment**ì—ì„œ `volumes.persistentVolumeClaim.claimName`ìœ¼ë¡œ ì°¸ì¡°.
  - `spec.selector.matchLabels.app: mysql` â†’ **PV**ì˜ `metadata.labels.app: mysqlê³¼ ë§¤ì¹­ë˜ì–´ mysql-pv`ë¥¼ ì„ íƒ.

#### 3. deployment.yaml (Deployment)

```yaml
apiVersion: apps/v1
kind: Deployment  # Deploymentë¥¼ ì •ì˜í•˜ëŠ” Kubernetes ë¦¬ì†ŒìŠ¤
metadata:
  name: mysql-deployment  # Deploymentì˜ ì´ë¦„
  namespace: park1  # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì§€ì •
spec:
  replicas: 1  # MySQL Podì„ 1ê°œ ì‹¤í–‰
  selector:
    matchLabels:
      app: mysql  # ì´ Deploymentê°€ ê´€ë¦¬í•  Pod ì„ íƒ ê¸°ì¤€
  template:
    metadata:
      labels:
        app: mysql  # ì´ Podì˜ ë¼ë²¨ (Serviceì—ì„œ ì°¸ì¡° ê°€ëŠ¥)
    spec:
      containers:
      - name: mysql  # ì»¨í…Œì´ë„ˆ ì´ë¦„
        image: 192.168.205.10:5000/mysql:latest  # ì‚¬ìš©í•  MySQL ì´ë¯¸ì§€
        env:
        - name: MYSQL_ROOT_PASSWORD  # MySQL ë£¨íŠ¸ ê³„ì • ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
          value: "root1"
        - name: MYSQL_DATABASE  # ìƒì„±í•  ê¸°ë³¸ ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„
          value: "lecture"
        - name: MYSQL_USER  # MySQL ì‚¬ìš©ì ê³„ì •
          value: "park"
        - name: MYSQL_PASSWORD  # MySQL ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸
          value: "park1234"
        ports:
        - containerPort: 3306  # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ MySQLì´ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸
        volumeMounts:
        - name: mysql-storage  # ë§ˆìš´íŠ¸í•  ë³¼ë¥¨ì˜ ì´ë¦„
          mountPath: /var/lib/mysql  # MySQL ë°ì´í„°ê°€ ì €ì¥ë  ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²½ë¡œ
      volumes:
      - name: mysql-storage
        persistentVolumeClaim:
          claimName: mysql-pvc  # PVCì™€ ì—°ê²°
```

- ì¤‘ìš”í•œ ì—°ê²° ì •ë³´:
  - `spec.selector.matchLabels.app: mysql` â†’ **Service**ì—ì„œ `spec.selector.app: mysql`ê³¼ ë§¤ì¹­.
  - `spec.template.metadata.labels.app: mysql` â†’ **Service**ì™€ ì—°ê²°.
  - `volumes.persistentVolumeClaim.claimName: mysql-pvc` â†’ **PVC** `metadata.name: mysql-pvc`ê³¼ ì—°ê²°.

#### 4. service.yaml (Service)

```yaml
apiVersion: v1
kind: Service  # Kubernetes ì„œë¹„ìŠ¤ ì •ì˜
metadata:
  name: mysql-service  # ì„œë¹„ìŠ¤ ì´ë¦„ (ë‚´ë¶€ DNSì—ì„œ mysql-service.park1.svcë¡œ ì‚¬ìš© ê°€ëŠ¥)
  namespace: park1  # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì§€ì •
spec:
  type: NodePort  # ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
  selector:
    app: mysql  # ì´ ë¼ë²¨ì„ ê°€ì§„ Podì„ ëŒ€ìƒìœ¼ë¡œ ì„œë¹„ìŠ¤ ì œê³µ
  ports:
  - protocol: TCP  # í”„ë¡œí† ì½œ ì§€ì • (MySQLì€ TCP ì‚¬ìš©)
    port: 3306  # ì„œë¹„ìŠ¤ê°€ ë…¸ì¶œí•  í¬íŠ¸ (í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ ì‚¬ìš©)
    targetPort: 3306  # Pod ë‚´ë¶€ ì»¨í…Œì´ë„ˆì—ì„œ MySQLì´ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸
    nodePort: 30306  # ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  ë•Œ ì‚¬ìš©í•  í¬íŠ¸ (ë…¸ë“œì˜ 30306 í¬íŠ¸ë¡œ ì ‘ì†í•˜ë©´ MySQLì— ì—°ê²°ë¨)
```

- ì¤‘ìš”í•œ ì—°ê²° ì •ë³´:
  - `spec.selector.app: mysql` â†’ **Deployment**ì—ì„œ `spec.template.metadata.labels.app: mysql`ê³¼ ì—°ê²°.
  - `ports.targetPort: 3306` â†’ **Deployment** ë‚´ ì»¨í…Œì´ë„ˆ `ports.containerPort: 3306`ê³¼ ì—°ê²°.
  - `nodePort: 30306` â†’ **í´ëŸ¬ìŠ¤í„° ì™¸ë¶€**ì—ì„œ **<NodeIP>:30306**ìœ¼ë¡œ MySQL ì ‘ê·¼ ê°€ëŠ¥.

### íŒŒì¼ ê°„ ì—°ê²° ìš”ì•½

```
(PersistentVolume) mysql-pv  â”€â”€â”€ [matchLabels: app=mysql] â”€â”€â–¶ mysql-pvc (PersistentVolumeClaim)
(PersistentVolumeClaim) mysql-pvc  â”€â”€â”€ [claimName: mysql-pvc] â”€â”€â–¶ Deployment (Podì˜ volumeMounts)
(Deployment) mysql-deployment  â”€â”€â”€ [labels: app=mysql] â”€â”€â–¶ Service (selector.app: mysql)
(Service) mysql-service  â”€â”€â”€â–¶ ì™¸ë¶€ ì ‘ì† ê°€ëŠ¥ (NodePort: 30306)
```

### ê²°ë¡ 

1. mysql-pvëŠ” mysql-pvcì—ì„œ matchLabels.app: mysqlë¡œ ì—°ê²°ë¨.
2. mysql-pvcëŠ” mysql-deploymentì—ì„œ volumes.persistentVolumeClaim.claimName: mysql-pvcë¡œ ì—°ê²°ë¨.
3. mysql-deploymentì˜ labels.app: mysqlì´ mysql-serviceì˜ spec.selector.app: mysqlê³¼ ì—°ê²°ë¨.
4. mysql-serviceëŠ” NodePort: 30306ìœ¼ë¡œ ì™¸ë¶€ ì ‘ì† ê°€ëŠ¥.

### ê²°ë¡  - 0

**mysql-service** ì˜ spec.selector.app (ì´ ë¼ë²¨ì„ ê°€ì§„ Podì„ ëŒ€ìƒìœ¼ë¡œ ì„œë¹„ìŠ¤ ì œê³µ): mysql = **mysql-deployment** ì˜ spec.template.metadata.labels.app (Podì˜ ë¼ë²¨): mysql

**mysql-deployment** ì˜ volumes.persistentVolumeClaim.claimName (PVCì™€ ì—°ê²°): mysql-pvc = **mysql-pvc** ì˜ metadata.name (PVCì˜ ì´ë¦„): mysql-pvc

**mysql-pvc** ì˜ spec.selector.matchLabels.app (ì´ ë¼ë²¨ì´ ìˆëŠ” PVë¥¼ ì„ íƒ): mysql = **mysql-pv** ì˜ metadata.labels.app: mysql

---

ë§Œì•½ `deployment.yaml`ì—ì„œ ì•„ë˜ì™€ ê°™ì´ `spec.template.metadata.labels.app` ê°’ì„ mod-mysqlë¡œ ë³€ê²½í•œë‹¤ë©´:

```yaml
spec:
  replicas: 1  
  selector:
    matchLabels:
      app: mysql  # ë³€ê²½ë˜ì§€ ì•ŠìŒ (Deploymentê°€ ê´€ë¦¬í•  Pod ì„ íƒ ê¸°ì¤€)
  template:
    metadata:
      labels:
        app: mod-mysql  # ê¸°ì¡´ mysql â†’ mod-mysql ë¡œ ë³€ê²½
```

Serviceì—ì„œ ë³€ê²½í•´ì•¼ í•  ë¶€ë¶‘ì€ ì•„ë˜ì™€ ê°™ë‹¤.

```yaml
spec:
  selector:
    app: mod-mysql  # ê¸°ì¡´ mysql â†’ mod-mysql ë¡œ ë³€ê²½
```

- ì´ìœ 
  - ServiceëŠ” spec.selector.app: mysqlì„ ê°€ì§„ Podì„ ëŒ€ìƒìœ¼ë¡œ íŠ¸ë˜í”½ì„ ì „ë‹¬í•¨.
  - ê·¸ëŸ°ë° Deploymentì—ì„œ template.metadata.labels.appì„ mod-mysqlë¡œ ë³€ê²½í•˜ë©´, ìƒì„±ë˜ëŠ” Podì˜ ë¼ë²¨ì´ app: mod-mysqlì´ ë¨.
  - Serviceì˜ selectorê°€ ì—¬ì „íˆ app: mysqlì´ë¼ë©´, ìƒˆ Podì„ ì°¾ì§€ ëª»í•˜ê²Œ ë¨.
  - ë”°ë¼ì„œ, service.yamlì—ì„œ selector.app: mysqlì„ **selector.app: mod-mysql**ë¡œ ë³€ê²½í•´ì•¼ í•¨.

---

**deployment.yaml**ì˜ `spec.template.metadata.labels.app` ê°’ì„ mysql â†’ mod-mysqlë¡œ ë³€ê²½í•œ í›„, `kubectl get pod -n park1`ì„ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ê°€ ì˜ˆìƒë¼.

1. ë³€ê²½ í›„ ë°”ë¡œ ì‹¤í–‰í•œ ê²½ìš°
```sh
kubectl get pod -n park1
```

ì¶œë ¥ ì˜ˆìƒ ê²°ê³¼
```sh
NAME                                READY   STATUS              RESTARTS   AGE
mysql-deployment-xxxxxxxxxx-xxxxx   0/1     ContainerCreating   0          5s
```

ì´ìœ :
Deploymentê°€ ê¸°ì¡´ Pod(app: mysql)ì„ ì¢…ë£Œí•˜ê³  ìƒˆë¡œìš´ Pod(app: mod-mysql)ì„ ìƒì„±í•˜ëŠ” ì¤‘.
ìƒˆë¡œìš´ Podì´ ContainerCreating ìƒíƒœì¸ ê²ƒì€ PVCì—ì„œ ë³¼ë¥¨ì„ ë§ˆìš´íŠ¸í•˜ê±°ë‚˜ MySQL ì»¨í…Œì´ë„ˆê°€ ì•„ì§ ì‹œì‘ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸.
ëª‡ ì´ˆ í›„ì— Running ìƒíƒœê°€ ë¨.

2. ëª‡ ì´ˆ í›„ ë‹¤ì‹œ ì‹¤í–‰í•œ ê²½ìš°

```sh
kubectl get pod -n park1
```

ì¶œë ¥ ì˜ˆìƒ ê²°ê³¼
```sh
NAME                                READY   STATUS    RESTARTS   AGE
mysql-deployment-xxxxxxxxxx-xxxxx   1/1     Running   0          30s
```

ì´ìœ :
ìƒˆë¡­ê²Œ ìƒì„±ëœ Podì´ ì •ìƒì ìœ¼ë¡œ Running ìƒíƒœê°€ ë¨.

3. ê¸°ì¡´ Podì´ ì‚­ì œë˜ëŠ” ê³¼ì •ì—ì„œ ì ê¹ ë³´ì¼ ìˆ˜ ìˆëŠ” ê²°ê³¼

```sh
NAME                                READY   STATUS        RESTARTS   AGE
mysql-deployment-yyyyyyyyyy-yyyyy   1/1     Terminating   0          5m
mysql-deployment-xxxxxxxxxx-xxxxx   0/1     ContainerCreating   0          3s
```

ì´ìœ :
Kubernetesê°€ ê¸°ì¡´ Pod (app: mysql)ì„ ì¢…ë£Œí•˜ê³  ìƒˆë¡œìš´ Pod (app: mod-mysql)ì„ ìƒì„±í•˜ëŠ” ê³¼ì •.
Terminating ìƒíƒœëŠ” ê¸°ì¡´ Podì´ ì œê±°ë˜ëŠ” ì¤‘ì´ë¼ëŠ” ëœ».
ëª‡ ì´ˆ í›„ì—ëŠ” Terminating ìƒíƒœì˜ Podì´ ì‚¬ë¼ì§€ê³  ìƒˆë¡œìš´ Podë§Œ ë‚¨ìŒ.

4. Serviceê°€ Podì„ ì°¾ì§€ ëª»í•˜ëŠ” ê²½ìš°

ë³€ê²½ í›„ kubectl get pod -n park1ìœ¼ë¡œ Podì´ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆì§€ë§Œ, kubectl get svc -n park1ìœ¼ë¡œ ì„œë¹„ìŠ¤ ìƒíƒœë¥¼ í™•ì¸í•´ ë³´ë©´ ì„œë¹„ìŠ¤ê°€ Podì„ ì°¾ì§€ ëª»í•˜ëŠ” ê²½ìš°ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ.

í™•ì¸ ëª…ë ¹ì–´
```sh
kubectl get endpoints mysql-service -n park1
```

ì¶œë ¥ ì˜ˆìƒ ê²°ê³¼ (Podì„ ëª» ì°¾ëŠ” ê²½ìš°)

```sh
NAME            ENDPOINTS   AGE
mysql-service   <none>      1m
```

ì´ ê²½ìš° service.yamlì˜ spec.selector.app: mysqlì„ spec.selector.app: mod-mysqlë¡œ ìˆ˜ì •í•œ í›„ ì ìš©í•´ì•¼ í•´.

```sh
kubectl apply -f service.yaml
```

ê²°ë¡ 
kubectl get pod -n park1ì„ ì‹¤í–‰í•˜ë©´ ì²˜ìŒì—ëŠ” ContainerCreating, ì´í›„ Running ìƒíƒœë¡œ ë³€ê²½ë¨.
kubectl get svc -n park1ì—ì„œ ENDPOINTSê°€ <none>ì´ë©´ service.yaml ìˆ˜ì • í•„ìš”.
ê¸°ì¡´ Podì´ Terminating ìƒíƒœê°€ ë  ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ ëª‡ ì´ˆ ê¸°ë‹¤ë ¸ë‹¤ê°€ í™•ì¸í•˜ë©´ ë¨.

ğŸš€ ìµœì¢…ì ìœ¼ë¡œ ìƒˆ Podì´ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ê³ , ì„œë¹„ìŠ¤ë„ Podì„ ì°¾ìœ¼ë©´ ë³€ê²½ì´ ì™„ë£Œëœ ê²ƒ!







